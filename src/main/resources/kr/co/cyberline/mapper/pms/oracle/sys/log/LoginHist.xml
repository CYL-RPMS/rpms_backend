<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="LoginHist">
	
	<insert id="insertLoginHist" parameterType="loginHistVO">
		<selectKey keyProperty="login_hist_id" resultType="java.lang.String" order="BEFORE">
			<![CDATA[
			SELECT LPAD(NVL(MAX(login_hist_id) , '0')+1, 20, '0') FROM CYL_CMM_0800_TH	
			]]>
		</selectKey>
		/* LoginHist.insertLoginHist : 로그인이력 등록 */
		<![CDATA[
		INSERT INTO CYL_CMM_0800_TH(
			  LOGIN_HIST_ID, LOGIN_ID, LOGIN_IP 
			, LOGIN_MTHD, CRTE_DTTM
		) VALUES (
			  #{login_hist_id}, #{login_id}, #{login_ip}
			, #{login_mthd}, SYSDATE
		)
		]]>
	</insert>
	
	<select id="selectLoginHistList" parameterType="loginHistVO" resultType="loginHistVO">
		/* LoginHist.selectLoginHistList : 로그인이력 목록 조회 */
		<include refid="CylCmm.prefixPagination"/>
		SELECT 
			A.LOGIN_HIST_ID, A.LOGIN_ID, A.LOGIN_IP, 
			A.LOGIN_MTHD, A.CRTE_DTTM, COUNT(1) OVER() AS TOT 
		FROM CYL_CMM_0800_TH A
		WHERE 1=1
		<if test="condLoginMthdCd != null and condLoginMthdCd != ''">
			AND A.LOGIN_MTHD = #{condLoginMthdCd}
		</if>
		<if test="searchType != null and searchType != ''">
        	<if test="searchKeyword != null and searchKeyword != ''">
	        	<if test="searchType == '001'">
	        	 	AND A.LOGIN_ID LIKE '%' || #{searchKeyword} || '%'
	        	</if>
	        	<if test="searchType == '002'">
	        	 	AND A.LOGIN_IP LIKE '%' || #{searchKeyword} || '%'
	        	</if>
        	</if>
        </if>
		<include refid="CylCmm.orderby"/>
		<include refid="CylCmm.suffixPagination"/>
	</select>
	
</mapper>