<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserLogin">

    <select id="actionLogin" parameterType="userVO" resultType="userVO">
        /* Login.actionLogin : 사용자 로그인 처리 */
        <![CDATA[
        SELECT
      		A.USER_ID, A.LOGIN_ID, A.PASSWD, A.USER_NM,
      		A.USER_STTUS_CD, A.CRTE_USER_ID, A.CRTE_DTTM,
      		A.UPDT_USER_ID, A.UPDT_DTTM, '' as DEPT_CD, '' as DEPT_NM, C.AUTHOR_NM_KR
        FROM CYL_CMM_0100_VN A LEFT OUTER JOIN (SELECT A.USER_ID
        											   ,A.AUTHOR_ID
        											   ,B.AUTHOR_NM_KR
        											   ,ROW_NUMBER() OVER(PARTITION BY USER_ID ORDER BY B.AUTHOR_PRIORT) RN
                       							  FROM CYL_CMM_0101_TN A
                      INNER JOIN CYL_CMM_0200_TN B
                          ON A.AUTHOR_ID = B.AUTHOR_ID) C
                          ON A.USER_ID = C.USER_ID
                         AND C.RN = 1
        WHERE A.LOGIN_ID = #{user_id} AND A.USER_STTUS_CD = 'P'
        ]]>
    </select>

</mapper>